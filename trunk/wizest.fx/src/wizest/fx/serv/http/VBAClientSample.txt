Public Declare Function SetTimer Lib "user32" ( _
    ByVal HWnd As Long, ByVal nIDEvent As Long, _
    ByVal uElapse As Long, ByVal lpTimerFunc As Long) As Long
    
Public Declare Function KillTimer Lib "user32" ( _
    ByVal HWnd As Long, ByVal nIDEvent As Long) As Long
    
Public TimerID As Long

Sub StartTimer()
    TimerID = SetTimer(0&, 0&, 1000&, AddressOf SendSheet)
    '그리고 타이머를 설정합니다. 1000&는 약 1초에 해당합니다.
    '1초마다 Main 프로시저를 실행하겠다는 것입니다
    '빠르게 실행하고 싶다면 이 숫자를 작게하면 됩니다..
End Sub

Sub StopTimer()
     KillTimer 0&, TimerID
    '설정한 타이머를 해제합니다.
End Sub

Sub SendSheet()
    Text = SendText(Now() & " helloooooooooooooooo~")
    Debug.Print Text
End Sub



Function SendText(Text)
    On Error GoTo ErrHandler:

    'Debug.Print "Start Time: " & Time
    
    Dim WinHTTP As Object
    Dim ResponseText
    Dim BodySent
    
    BodySent = Text
    Set WinHTTP = CreateObject("WinHttp.WinHttpRequest.5.1")
    
    WinHTTP.Open "PUT", "http://127.0.0.1:8888", False
    WinHTTP.SetTimeouts 1000, 1000, 1000, 1000
    
    WinHTTP.setRequestHeader "Content-Type", "text/plain"
    
    WinHTTP.send BodySent
    
    'Debug.Print WinHTTP.Status & " - " & WinHTTP.StatusText
    If WinHTTP.StatusText = "OK" Then
        ResponseText = WinHTTP.ResponseText
        'Debug.Print ResponseText
    End If
    
    Set WinHTTP = Nothing
    
    SendText = ResponseText
    'Debug.Print "End Time: " & Time
    
    Exit Function
    
ErrHandler:
    SendText = Date & " " & Time & ":" & Error
    Debug.Print SendText
    
End Function


